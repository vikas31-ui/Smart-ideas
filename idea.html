<script>
  const firebaseConfig = {
    apiKey: "YOUR_API_KEY",
    authDomain: "YOUR_PROJECT.firebaseapp.com",
    databaseURL: "https://YOUR_PROJECT.firebaseio.com",
    projectId: "YOUR_PROJECT",
    storageBucket: "YOUR_PROJECT.appspot.com",
    messagingSenderId: "YOUR_SENDER_ID",
    appId: "YOUR_APP_ID"
  };
  firebase.initializeApp(firebaseConfig);
  const db = firebase.database();
  const auth = firebase.auth();

  const form = document.getElementById('ideaForm');
  const list = document.getElementById('ideasList');
  const loginBtn = document.getElementById('loginBtn');
  const userInfo = document.getElementById('userInfo');

  let currentUser = null;

  auth.onAuthStateChanged(user => {
    if (user) {
      currentUser = user;
      userInfo.innerHTML = `Logged in as <b>${user.displayName}</b> (${user.email})`;
      loginBtn.innerText = "Sign Out";
    } else {
      currentUser = null;
      userInfo.innerHTML = "";
      loginBtn.innerText = "Sign in with Google";
    }
  });

  loginBtn.onclick = () => {
    if (currentUser) {
      auth.signOut();
    } else {
      const provider = new firebase.auth.GoogleAuthProvider();
      auth.signInWithPopup(provider);
    }
  };

  db.ref('ideas').on('value', snapshot => {
    list.innerHTML = '';
    snapshot.forEach(child => {
      const data = child.val();
      const id = child.key;
      addIdeaToList(data, id);
    });
  });

  form.addEventListener('submit', e => {
    e.preventDefault();
    if (!currentUser) return alert("Please sign in to post your idea.");
    const name = currentUser.displayName;
    const email = currentUser.email;
    const idea = form.idea.value.trim();
    if (!idea) return;
    const entry = { name, email, idea, time: Date.now() };
    db.ref('ideas').push(entry);
    form.reset();
  });

  function addIdeaToList(entry, id) {
    const li = document.createElement('li');
    const ts = new Date(entry.time).toLocaleString();
    li.innerHTML = `
      <strong>${entry.name}</strong> <em>(${ts})</em><br>${entry.idea}
      ${currentUser && currentUser.email === entry.email ? `<br><button class="delBtn">Delete</button>` : ''}
    `;
    if (currentUser && currentUser.email === entry.email) {
      li.querySelector('.delBtn').onclick = () => {
        db.ref('ideas/' + id).remove();
        li.remove();
      };
    }
    list.prepend(li);
  }
</script>
